<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>StyloVendas - Sistema Funcional</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    
    <style>
        :root{--primary-color:#6a11cb;--secondary-color:#2575fc;--background-color:#f4f7fc;--sidebar-bg:#1c1d26;--sidebar-text:#e0e0e0;--sidebar-text-hover:#ffffff;--card-bg:#ffffff;--text-color:#333333;--shadow:0 4px 15px rgba(0,0,0,0.1);--border-radius:12px;--danger-color:#c62828;}
        *{margin:0;padding:0;box-sizing:border-box;font-family:'Poppins',sans-serif;}
        body{background-color:var(--background-color);}
        #login-screen{display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));transition:opacity .5s ease-out;}
        .login-container{background:var(--card-bg);padding:40px 30px;border-radius:var(--border-radius);box-shadow:0 10px 30px rgba(0,0,0,.2);width:90%;max-width:400px;text-align:center;transform:scale(.95);animation:scaleIn .5s forwards;}
        @keyframes scaleIn{to{transform:scale(1)}}
        .login-container h2{color:var(--primary-color);margin-bottom:10px;font-size:2rem;}
        .login-container .logo{font-weight:700;letter-spacing:1px;}
        .login-container p{color:#888;margin-bottom:30px;}
        .input-group{position:relative;margin-bottom:25px;text-align:left;}
        .input-group input,.input-group select{width:100%;padding:15px;padding-left:45px;border:1px solid #ddd;border-radius:8px;font-size:1rem;transition:border-color .3s;}
        .input-group select{padding-left:15px;}
        .input-group input:focus,.input-group select:focus{outline:none;border-color:var(--primary-color);}
        .input-group i{position:absolute;left:15px;top:50%;transform:translateY(-50%);color:#aaa;}
        .login-btn,.primary-btn{width:100%;padding:15px;border:none;border-radius:8px;background:linear-gradient(135deg,var(--primary-color),var(--secondary-color));color:#fff;font-size:1.1rem;font-weight:600;cursor:pointer;transition:transform .2s,box-shadow .2s;}
        .login-btn:hover,.primary-btn:hover{transform:translateY(-2px);box-shadow:0 6px 20px rgba(37,117,252,.4);}
        #main-app{display:none;grid-template-columns:260px 1fr;grid-template-rows:auto 1fr;min-height:100vh;grid-template-areas:"sidebar header" "sidebar content";transition:grid-template-columns .3s ease;}
        .sidebar{grid-area:sidebar;background-color:var(--sidebar-bg);color:var(--sidebar-text);padding:20px;display:flex;flex-direction:column;transition:transform .3s ease;}
        .sidebar-header{display:flex;align-items:center;gap:15px;margin-bottom:40px;}
        .sidebar-header .logo-icon{font-size:2rem;color:var(--secondary-color);}
        .sidebar-header h2{font-size:1.5rem;font-weight:600;color:#fff;}
        .sidebar-menu ul{list-style:none;}
        .sidebar-menu li a{display:flex;align-items:center;gap:15px;padding:15px 10px;border-radius:8px;color:var(--sidebar-text);text-decoration:none;font-weight:500;transition:background-color .3s,color .3s;}
        .sidebar-menu li a:hover,.sidebar-menu li a.active{background-color:rgba(37,117,252,.2);color:var(--sidebar-text-hover);}
        .sidebar-menu li a i{width:20px;text-align:center;}
        .sidebar-footer{margin-top:auto;}
        .header{grid-area:header;display:flex;justify-content:space-between;align-items:center;padding:20px;background-color:var(--card-bg);box-shadow:0 2px 5px rgba(0,0,0,.05);z-index:10;}
        .header .menu-toggle{display:none;cursor:pointer;font-size:1.5rem;color:var(--text-color);}
        .header .user-info{display:flex;align-items:center;gap:15px;}
        .header .user-info img{width:40px;height:40px;border-radius:50%;object-fit:cover;}
        .main-content{grid-area:content;padding:30px;overflow-y:auto;}
        .page-content{display:none;}
        .page-content.active{display:block;animation:fadeIn .5s;}
        @keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}
        .page-header{margin-bottom:30px;}
        .page-header h1{font-size:2rem;font-weight:600;}
        .cards-container{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:25px;}
        .card{background-color:var(--card-bg);padding:25px;border-radius:var(--border-radius);box-shadow:var(--shadow);display:flex;align-items:center;gap:20px;transition:transform .3s,box-shadow .3s;}
        .card:hover{transform:translateY(-5px);box-shadow:0 8px 25px rgba(0,0,0,.15);}
        .card .icon-wrapper{font-size:2rem;padding:20px;border-radius:50%;display:flex;justify-content:center;align-items:center;}
        .card.sales .icon-wrapper{background-color:#e0f7fa;color:#00838f;}
        .card.revenue .icon-wrapper{background-color:#e8f5e9;color:#2e7d32;}
        .card.customers .icon-wrapper{background-color:#fff3e0;color:#ef6c00;}
        .card.pending .icon-wrapper{background-color:#ffebee;color:#c62828;}
        .card-info h3{font-size:2.2rem;font-weight:600;color:var(--text-color);}
        .card-info p{color:#888;}
        .content-block{margin-top:40px;background-color:var(--card-bg);padding:30px;border-radius:var(--border-radius);box-shadow:var(--shadow);}
        .content-block-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
        .content-block-header h2{font-size:1.5rem;}
        .primary-btn{width:auto;font-size:1rem;padding:10px 20px;}
        .danger-btn{background:var(--danger-color);padding:5px 10px;font-size:.8rem;border:none;border-radius:5px;color:#fff;cursor:pointer;}
        table{width:100%;border-collapse:collapse;color:#555;}
        table th,table td{padding:15px;text-align:left;border-bottom:1px solid #eee;}
        table th{font-weight:600;color:#333;}
        table tfoot tr{border-top:2px solid #333;font-weight:700;}
        table tfoot td{font-size:1.2rem;}
        table .actions i{cursor:pointer;margin-right:15px;color:#777;transition:color .2s;}
        table .actions i.fa-trash:hover{color:var(--danger-color);}
        .status{padding:5px 10px;border-radius:20px;font-size:.8rem;font-weight:600;}
        .status.paid{background-color:#e8f5e9;color:#2e7d32;}
        .status.pending{background-color:#ffebee;color:#c62828;}
        .modal{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;overflow:auto;background-color:rgba(0,0,0,.5);}
        .modal-content{background-color:#fefefe;margin:10% auto;padding:30px;border-radius:var(--border-radius);width:90%;max-width:500px;animation:scaleIn .3s;}
        .modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px;}
        .close-btn{color:#aaa;font-size:28px;font-weight:700;cursor:pointer;}
        .modal-body form .input-group{margin-bottom:15px;}
        @media (max-width:768px){#main-app{grid-template-columns:1fr;grid-template-areas:"header" "content"}
        .sidebar{position:fixed;left:0;top:0;height:100%;z-index:1000;transform:translateX(-100%);}
        .sidebar.show{transform:translateX(0);box-shadow:10px 0 20px rgba(0,0,0,.1);}
        .header .menu-toggle{display:block;}
        .main-content{padding:20px;}
        .page-header h1{font-size:1.8rem;}
        .content-block{padding:20px;}}
    </style>
</head>
<body>

    <div id="login-screen">
        <div class="login-container">
            <h2 class="logo"><i class="fas fa-gem"></i> StyloVendas</h2><p>Faça login para gerenciar sua loja</p>
            <form id="login-form"><div class="input-group"><i class="fas fa-user"></i><input type="text" placeholder="Usuário" required value="admin"></div><div class="input-group"><i class="fas fa-lock"></i><input type="password" placeholder="Senha" required value="1234"></div><button type="submit" class="login-btn">Entrar</button></form>
        </div>
    </div>

    <div id="main-app">
        <aside class="sidebar">
            <div class="sidebar-header"><i class="fas fa-gem logo-icon"></i><h2>StyloVendas</h2></div>
            <nav class="sidebar-menu"><ul><li><a href="#" class="nav-link active" data-target="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li><li><a href="#" class="nav-link" data-target="sales"><i class="fas fa-cash-register"></i> Registrar Venda</a></li><li><a href="#" class="nav-link" data-target="products"><i class="fas fa-tshirt"></i> Produtos</a></li><li><a href="#" class="nav-link" data-target="customers"><i class="fas fa-users"></i> Clientes</a></li><li><a href="#" class="nav-link" data-target="inventory"><i class="fas fa-boxes"></i> Estoque</a></li><li><a href="#" class="nav-link" data-target="debts"><i class="fas fa-hand-holding-usd"></i> Contas a Receber</a></li><li><a href="#" class="nav-link" data-target="reports"><i class="fas fa-chart-pie"></i> Relatórios</a></li></ul></nav>
            <div class="sidebar-footer"><a href="#" id="logout-btn" class="nav-link"><i class="fas fa-sign-out-alt"></i> Sair</a></div>
        </aside>
        <header class="header">
            <i class="fas fa-bars menu-toggle"></i><div class="user-info"><span>Olá, <strong>Admin</strong></span><img src="https://i.pravatar.cc/150?img=32" alt="Foto do Usuário"></div>
        </header>
        <main class="main-content">
            <div id="dashboard" class="page-content active"><div class="page-header"><h1>Dashboard</h1><p>Visão geral do seu negócio.</p></div><div class="cards-container" id="dashboard-cards"></div></div>
            
            <div id="sales" class="page-content">
                <div class="page-header"><h1>Registrar Nova Venda</h1></div>
                
                <div class="content-block">
                    <form id="add-to-cart-form">
                        <h2 style="margin-bottom: 20px;">Adicionar Produto ao Carrinho</h2>
                        <div style="display: grid; grid-template-columns: 2fr 1fr 1fr; gap: 15px; align-items: flex-end;">
                            <div class="input-group" style="margin:0;"><label>Produto</label><select id="sale-product" required></select></div>
                            <div class="input-group" style="margin:0;"><label>Qtd.</label><input type="number" id="sale-quantity" value="1" min="1" required></div>
                            <button type="submit" class="primary-btn">Adicionar</button>
                        </div>
                    </form>
                </div>

                <div class="content-block">
                    <form id="sale-form">
                        <h2>Carrinho</h2>
                        <table>
                            <thead><tr><th>Produto</th><th>Qtd.</th><th>Preço Unit.</th><th>Subtotal</th><th>Ação</th></tr></thead>
                            <tbody id="sale-cart-body"></tbody>
                            <tfoot><tr><td colspan="3">TOTAL</td><td id="sale-total" colspan="2">R$ 0,00</td></tr></tfoot>
                        </table>
                        
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                             <div class="input-group"><label>Cliente</label><select id="sale-customer" required></select></div>
                             <div class="input-group"><label>Forma de Pagamento</label><select id="sale-payment-method" required><option value="Dinheiro">Dinheiro</option><option value="Cartão de Crédito">Cartão de Crédito</option><option value="Cartão de Débito">Cartão de Débito</option><option value="Pix">Pix</option><option value="Fiado">Fiado</option></select></div>
                        </div>
                        <button type="submit" class="primary-btn" style="width: 100%; margin-top: 20px;">Finalizar Venda</button>
                    </form>
                </div>
            </div>
            
            <div id="products" class="page-content">
                <div class="page-header"><h1>Gestão de Produtos</h1></div>
                <div class="content-block"><div class="content-block-header"><h2>Lista de Produtos</h2><button id="add-product-btn" class="primary-btn"><i class="fas fa-plus"></i> Novo Produto</button></div><table><thead><tr><th>SKU</th><th>Produto</th><th>Preço</th><th>Estoque</th><th>Ações</th></tr></thead><tbody id="products-table-body"></tbody></table></div>
            </div>
            <div id="customers" class="page-content">
                 <div class="page-header"><h1>Gestão de Clientes</h1></div>
                 <div class="content-block"><div class="content-block-header"><h2>Lista de Clientes</h2><button id="add-customer-btn" class="primary-btn"><i class="fas fa-plus"></i> Novo Cliente</button></div><table><thead><tr><th>Nome</th><th>Contato</th><th>Desde</th><th>Ações</th></tr></thead><tbody id="customers-table-body"></tbody></table></div>
            </div>
            
            <div id="inventory" class="page-content"><div class="page-header"><h1>Controle de Estoque</h1><p>A tabela de produtos já reflete o estoque atual.</p></div></div>
            <div id="debts" class="page-content"><div class="page-header"><h1>Contas a Receber (Fiado)</h1><p>Funcionalidade em desenvolvimento.</p></div></div>
            <div id="reports" class="page-content"><div class="page-header"><h1>Relatórios</h1><p>Funcionalidade em desenvolvimento.</p></div></div>
        </main>
    </div>
    
    <div id="customer-modal" class="modal"><div class="modal-content"><div class="modal-header"><h2>Novo Cliente</h2><span class="close-btn">&times;</span></div><div class="modal-body"><form id="customer-form"><div class="input-group"><input type="text" id="customer-name" placeholder="Nome completo" required></div><div class="input-group"><input type="tel" id="customer-contact" placeholder="Telefone / WhatsApp" required></div><button type="submit" class="primary-btn">Salvar Cliente</button></form></div></div></div>
    <div id="product-modal" class="modal"><div class="modal-content"><div class="modal-header"><h2>Novo Produto</h2><span class="close-btn">&times;</span></div><div class="modal-body"><form id="product-form"><div class="input-group"><input type="text" id="product-name" placeholder="Nome do Produto" required></div><div class="input-group"><input type="text" id="product-sku" placeholder="SKU (Código Único)" required></div><div class="input-group"><input type="number" id="product-price" placeholder="Preço (ex: 49.90)" step="0.01" required></div><div class="input-group"><input type="number" id="product-stock" placeholder="Quantidade em Estoque" required></div><button type="submit" class="primary-btn">Salvar Produto</button></form></div></div></div>

    <script>
    document.addEventListener('DOMContentLoaded', function() {
        // --- ELEMENTOS GLOBAIS ---
        let db;
        let currentSale = { items: [], total: 0 };
        const mainApp = document.getElementById('main-app');
        const loginForm = document.getElementById('login-form');
        const loginScreen = document.getElementById('login-screen');

        // --- BANCO DE DADOS LOCALSTORAGE ---
        function loadDatabase() {
            const dbJSON = localStorage.getItem('styloVendasDB');
            db = dbJSON ? JSON.parse(dbJSON) : { products: [], customers: [], sales: [] };
        }
        function saveDatabase() {
            localStorage.setItem('styloVendasDB', JSON.stringify(db));
        }
        function render() {
            renderDashboard();
            renderCustomersTable();
            renderProductsTable();
        }

        // --- RENDERIZAÇÃO ---
        function renderDashboard() {
            const totalRevenue = db.sales.reduce((sum, sale) => sum + sale.total, 0);
            const totalSales = db.sales.length;
            document.getElementById('dashboard-cards').innerHTML = `
                <div class="card revenue"><div class="icon-wrapper"><i class="fas fa-dollar-sign"></i></div><div class="card-info"><h3>R$ ${totalRevenue.toFixed(2)}</h3><p>Receita Total</p></div></div>
                <div class="card sales"><div class="icon-wrapper"><i class="fas fa-tags"></i></div><div class="card-info"><h3>${totalSales}</h3><p>Vendas Totais</p></div></div>
                <div class="card customers"><div class="icon-wrapper"><i class="fas fa-users"></i></div><div class="card-info"><h3>${db.customers.length}</h3><p>Clientes</p></div></div>
                <div class="card pending"><div class="icon-wrapper"><i class="fas fa-tshirt"></i></div><div class="card-info"><h3>${db.products.length}</h3><p>Produtos</p></div></div>`;
        }
        function renderCustomersTable() {
            const tableBody = document.getElementById('customers-table-body');
            tableBody.innerHTML = '';
            db.customers.forEach(c => { tableBody.innerHTML += `<tr><td>${c.name}</td><td>${c.contact}</td><td>${c.since}</td><td class="actions"><i class="fas fa-trash" onclick="deleteEntity('customers', ${c.id})"></i></td></tr>`; });
        }
        function renderProductsTable() {
            const tableBody = document.getElementById('products-table-body');
            tableBody.innerHTML = '';
            db.products.forEach(p => { tableBody.innerHTML += `<tr><td>${p.sku}</td><td>${p.name}</td><td>R$ ${p.price.toFixed(2)}</td><td>${p.stock}</td><td class="actions"><i class="fas fa-trash" onclick="deleteEntity('products', ${p.id})"></i></td></tr>`; });
        }
        
        // --- LÓGICA DE VENDAS ---
        function renderSalePage() {
            const customerSelect = document.getElementById('sale-customer');
            customerSelect.innerHTML = '<option value="0">Consumidor Final</option>';
            db.customers.forEach(c => { customerSelect.innerHTML += `<option value="${c.id}">${c.name}</option>`; });

            const productSelect = document.getElementById('sale-product');
            productSelect.innerHTML = '<option value="">Selecione um produto</option>';
            db.products.forEach(p => { if (p.stock > 0) productSelect.innerHTML += `<option value="${p.id}">${p.name} (Estoque: ${p.stock})</option>`; });
        }

        function renderSaleCart() {
            const cartBody = document.getElementById('sale-cart-body');
            cartBody.innerHTML = '';
            currentSale.total = 0;
            currentSale.items.forEach(item => {
                const product = db.products.find(p => p.id === item.productId);
                const subtotal = item.quantity * product.price;
                currentSale.total += subtotal;
                cartBody.innerHTML += `
                    <tr><td>${product.name}</td><td>${item.quantity}</td><td>R$ ${product.price.toFixed(2)}</td><td>R$ ${subtotal.toFixed(2)}</td>
                    <td><button type="button" class="danger-btn" onclick="removeFromCart(${product.id})">Remover</button></td></tr>`;
            });
            document.getElementById('sale-total').innerText = `R$ ${currentSale.total.toFixed(2)}`;
        }

        document.getElementById('add-to-cart-form').addEventListener('submit', function(e) {
            e.preventDefault();
            const productId = parseInt(document.getElementById('sale-product').value);
            const quantity = parseInt(document.getElementById('sale-quantity').value);
            const product = db.products.find(p => p.id === productId);

            if (!product || quantity <= 0) { alert('Produto inválido ou quantidade zerada.'); return; }
            if (quantity > product.stock) { alert('Quantidade solicitada maior que o estoque disponível!'); return; }
            
            const existingItem = currentSale.items.find(item => item.productId === productId);
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                currentSale.items.push({ productId, quantity });
            }
            renderSaleCart();
        });
        
        window.removeFromCart = (productId) => {
            currentSale.items = currentSale.items.filter(item => item.productId !== productId);
            renderSaleCart();
        }

        document.getElementById('sale-form').addEventListener('submit', function(e) {
            e.preventDefault();
            if (currentSale.items.length === 0) { alert('O carrinho está vazio!'); return; }

            // 1. Abater do estoque
            currentSale.items.forEach(item => {
                const product = db.products.find(p => p.id === item.productId);
                product.stock -= item.quantity;
            });

            // 2. Criar registro da venda
            const saleRecord = {
                id: Date.now(),
                customerId: parseInt(document.getElementById('sale-customer').value),
                items: currentSale.items.map(item => ({...item, priceAtSale: db.products.find(p => p.id === item.productId).price})),
                total: currentSale.total,
                paymentMethod: document.getElementById('sale-payment-method').value,
                status: document.getElementById('sale-payment-method').value === 'Fiado' ? 'Pendente' : 'Pago',
                date: new Date().toISOString()
            };
            db.sales.push(saleRecord);
            saveDatabase();
            
            // 3. Limpar e dar feedback
            alert('Venda registrada com sucesso!');
            currentSale = { items: [], total: 0 };
            document.getElementById('add-to-cart-form').reset();
            renderSaleCart();
            render(); // Atualiza toda a UI (estoque, dashboard)
        });

        // --- CRUD GENÉRICO ---
        window.deleteEntity = (type, id) => {
            if (confirm(`Tem certeza que deseja excluir este item de ${type}?`)) {
                db[type] = db[type].filter(item => item.id !== id);
                saveDatabase();
                render();
            }
        }

        // --- MODAIS E FORMULÁRIOS (clientes, produtos) ---
        const customerModal=document.getElementById('customer-modal'),productModal=document.getElementById('product-modal'),modals={customer:customerModal,product:productModal};
        document.getElementById('add-customer-btn').onclick=()=>modals.customer.style.display='block';
        document.getElementById('add-product-btn').onclick=()=>modals.product.style.display='block';
        Object.values(modals).forEach(m=>{m.querySelector('.close-btn').onclick=()=>m.style.display='none'});
        window.onclick=e=>{Object.values(modals).forEach(m=>{if(e.target==m)m.style.display='none'})};
        document.getElementById('customer-form').addEventListener('submit',function(e){e.preventDefault();db.customers.push({id:Date.now(),name:document.getElementById('customer-name').value,contact:document.getElementById('customer-contact').value,since:new Date().toLocaleDateString('pt-BR')});saveDatabase();render();this.reset();modals.customer.style.display='none'});
        document.getElementById('product-form').addEventListener('submit',function(e){e.preventDefault();db.products.push({id:Date.now(),name:document.getElementById('product-name').value,sku:document.getElementById('product-sku').value,price:parseFloat(document.getElementById('product-price').value),stock:parseInt(document.getElementById('product-stock').value)});saveDatabase();render();this.reset();modals.product.style.display='none'});

        // --- NAVEGAÇÃO E INICIALIZAÇÃO ---
        const navLinks=document.querySelectorAll('.nav-link'),pages=document.querySelectorAll('.page-content'),menuToggle=document.querySelector('.menu-toggle'),sidebar=document.querySelector('.sidebar');
        loginForm.addEventListener('submit',e=>{e.preventDefault();loadDatabase();render();loginScreen.style.opacity='0';setTimeout(()=>{loginScreen.style.display='none';mainApp.style.display='grid'},500)});
        document.getElementById('logout-btn').addEventListener('click',e=>{e.preventDefault();mainApp.style.display='none';loginScreen.style.display='flex';setTimeout(()=>loginScreen.style.opacity='1',50)});
        navLinks.forEach(link=>{link.addEventListener('click',e=>{e.preventDefault();if(link.id==='logout-btn')return;const targetId=link.getAttribute('data-target');if(targetId==='sales')renderSalePage();navLinks.forEach(n=>n.classList.remove('active'));link.classList.add('active');pages.forEach(p=>p.classList.toggle('active',p.id===targetId));if(window.innerWidth<=768)sidebar.classList.remove('show')})});
        menuToggle.addEventListener('click',()=>sidebar.classList.toggle('show'));
    });
    </script>
</body>
</html>
