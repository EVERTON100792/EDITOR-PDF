<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Editor de PDF para Tabela</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f4f4;
      margin: 20px;
      text-align: center;
    }

    h1 {
      color: #333;
    }

    input[type="file"], button {
      margin: 10px;
      padding: 8px 16px;
      font-size: 16px;
    }

    #table-container {
      margin-top: 20px;
      overflow-x: auto;
    }

    table {
      margin: auto;
      border-collapse: collapse;
      width: 90%;
      background: white;
    }

    th, td {
      border: 1px solid #ccc;
      padding: 8px;
      min-width: 100px;
      text-align: left;
    }

    td {
      cursor: text;
    }

    /* ESCONDER INTERFACE NA IMPRESSÃO */
    @media print {
      h1,
      input,
      button {
        display: none !important;
      }

      body {
        background: white !important;
        margin: 0;
      }

      #table-container {
        overflow-x: visible !important;
        width: 100% !important;
      }

      table {
        width: 100% !important;
        table-layout: fixed;
        word-wrap: break-word;
      }
    }
  </style>
</head>
<body>
  <h1>Conversor e Editor de PDF para Tabela</h1>
  <input type="file" id="pdfFile" accept="application/pdf">
  <button onclick="printPage()">Imprimir / Salvar PDF</button>

  <div id="table-container"></div>

  <!-- PDF.js CDN -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
  <script>
    const pdfInput = document.getElementById("pdfFile");
    const container = document.getElementById("table-container");

    pdfInput.addEventListener("change", async function () {
      const file = this.files[0];
      if (file && file.type === "application/pdf") {
        const fileReader = new FileReader();
        fileReader.onload = async function () {
          const typedArray = new Uint8Array(this.result);
          const pdf = await pdfjsLib.getDocument({ data: typedArray }).promise;
          let fullText = "";

          for (let pageNum = 1; pageNum <= pdf.numPages; pageNum++) {
            const page = await pdf.getPage(pageNum);
            const content = await page.getTextContent();
            const pageText = content.items.map(item => item.str).join(' ');
            fullText += pageText + "\n";
          }

          generateTableFromText(fullText);
        };
        fileReader.readAsArrayBuffer(file);
      }
    });

    function generateTableFromText(text) {
      const lines = text.trim().split("\n");
      const table = document.createElement("table");

      lines.forEach(line => {
        const row = document.createElement("tr");

        // Separar colunas por múltiplos espaços ou tabulação
        const cols = line.split(/\s{2,}|\t+/);
        cols.forEach(col => {
          const cell = document.createElement("td");
          cell.contentEditable = true;
          cell.textContent = col.trim();
          row.appendChild(cell);
        });

        table.appendChild(row);
      });

      container.innerHTML = "";
      container.appendChild(table);
    }

    function printPage() {
      window.print();
    }
  </script>
</body>
</html>
